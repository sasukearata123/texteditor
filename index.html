<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Document Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }

        .toolbar {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 15px 20px;
            border-bottom: 3px solid #3498db;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
            padding: 5px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .toolbar button, .toolbar select, .toolbar input[type="color"] {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .toolbar button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(52, 152, 219, 0.4);
        }

        .toolbar button.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .toolbar select {
            min-width: 120px;
            color: #333;
            background: white;
        }

        .toolbar select option {
            color: #333;
            background: white;
        }

        .toolbar input[type="color"] {
            width: 40px;
            height: 35px;
            padding: 2px;
        }

        .editor-container {
            display: flex;
            height: calc(100vh - 100px);
        }

        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border-right: 2px solid #dee2e6;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 18px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .sidebar button {
            width: 100%;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .sidebar button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        }

        .editor {
            flex: 1;
            padding: 30px;
            background: white;
            overflow-y: auto;
        }

        .document {
            min-height: 800px;
            background: white;
            border: 1px solid #ddd;
            padding: 40px;
            margin: 0 auto;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 10px;
            line-height: 1.6;
        }

        .document:focus {
            outline: 2px solid #3498db;
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 24px;
            text-align: center;
        }

        .modal input, .modal select, .modal textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .modal input:focus, .modal select:focus, .modal textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .modal button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .modal .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .modal .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .modal .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .modal button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .image-container {
            position: relative;
            display: inline-block;
            margin: 10px;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .image-container:hover img {
            transform: scale(1.02);
        }

        .image-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
            gap: 5px;
        }

        .image-container:hover .image-controls {
            display: flex;
        }

        .image-controls button {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        table th, table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        table th {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-weight: bold;
        }

        table tr:nth-child(even) {
            background: #f8f9fa;
        }

        table tr:hover {
            background: #e3f2fd;
        }

        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #3498db;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #ecf0f1;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                gap: 10px;
            }
            
            .editor-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .document {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="toolbar">
            <div class="toolbar-group">
                <select id="fontFamily">
                    <option value="Arial">Arial</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Verdana">Verdana</option>
                </select>
                <select id="fontSize">
                    <option value="12px">12px</option>
                    <option value="14px">14px</option>
                    <option value="16px" selected>16px</option>
                    <option value="18px">18px</option>
                    <option value="20px">20px</option>
                    <option value="24px">24px</option>
                    <option value="32px">32px</option>
                </select>
            </div>
            
            <div class="toolbar-group">
                <button onclick="formatText('bold')" title="Bold">B</button>
                <button onclick="formatText('italic')" title="Italic">I</button>
                <button onclick="formatText('underline')" title="Underline">U</button>
            </div>
            
            <div class="toolbar-group">
                <button onclick="formatText('justifyLeft')" title="Align Left">←</button>
                <button onclick="formatText('justifyCenter')" title="Center">↔</button>
                <button onclick="formatText('justifyRight')" title="Align Right">→</button>
                <button onclick="formatText('insertUnorderedList')" title="Bullet List">•</button>
                <button onclick="formatText('insertOrderedList')" title="Numbered List">1.</button>
            </div>
            
            <div class="toolbar-group">
                <button onclick="formatText('undo')" title="Undo">⟲</button>
                <button onclick="formatText('redo')" title="Redo">⟳</button>
            </div>
        </div>

        <div class="editor-container">
            <div class="sidebar">
                <h3>Insert</h3>
                <button onclick="showImageModal()">📷 Add Image</button>
                <button onclick="showTableModal()">📊 Add Table</button>
                <button onclick="insertQuickChart('bar')">📊 Bar Chart</button>
                <button onclick="insertQuickChart('line')">📈 Line Chart</button>
                <button onclick="insertQuickChart('pie')">🥧 Pie Chart</button>
                <button onclick="insertQuickChart('doughnut')">🍩 Doughnut Chart</button>
                
                <h3>Export</h3>
                <button onclick="exportToPDF()">📄 Export PDF</button>
                
                <div class="loading" id="loadingIndicator">
                    <div>Processing...</div>
                    <div class="progress-bar">
                        <div class="progress" id="progressBar"></div>
                    </div>
                </div>
            </div>

            <div class="editor">
                <div class="document" id="document" contenteditable="true">
                    <h1>Welcome to Advanced Document Editor</h1>
                    <p>Start typing your document here. You can format text, add images, create tables, insert charts, and export to PDF or DOC format.</p>
                    <p>Use the toolbar above for formatting options and the sidebar for inserting content and exporting your document.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <h3>Add Image</h3>
            <input type="file" id="imageFile" accept="image/*">
            <input type="url" id="imageUrl" placeholder="Or enter image URL">
            <input type="range" id="imageWidth" min="50" max="800" value="300">
            <label>Width: <span id="widthValue">300px</span></label>
            <div class="modal-buttons">
                <button class="btn-primary" onclick="insertImage()">Add Image</button>
                <button class="btn-secondary" onclick="closeModal('imageModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Table Modal -->
    <div id="tableModal" class="modal">
        <div class="modal-content">
            <h3>Create Table</h3>
            <input type="number" id="tableRows" placeholder="Number of rows" min="1" max="20" value="3">
            <input type="number" id="tableCols" placeholder="Number of columns" min="1" max="10" value="3">
            <input type="text" id="tableTitle" placeholder="Table title (optional)">
            <div class="modal-buttons">
                <button class="btn-primary" onclick="insertTable()">Create Table</button>
                <button class="btn-secondary" onclick="closeModal('tableModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Chart Modal -->
    <div id="chartModal" class="modal">
        <div class="modal-content">
            <h3>Create Chart</h3>
            <select id="chartType">
                <option value="bar">Bar Chart</option>
                <option value="line">Line Chart</option>
                <option value="pie">Pie Chart</option>
                <option value="doughnut">Doughnut Chart</option>
            </select>
            <input type="text" id="chartTitle" placeholder="Chart title">
            <textarea id="chartData" placeholder="Enter data as JSON:
{
  &quot;labels&quot;: [&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;],
  &quot;datasets&quot;: [{
    &quot;label&quot;: &quot;Sales&quot;,
    &quot;data&quot;: [12, 19, 3, 17],
    &quot;backgroundColor&quot;: [&quot;#FF6384&quot;, &quot;#36A2EB&quot;, &quot;#FFCE56&quot;, &quot;#4BC0C0&quot;]
  }]
}" rows="10"></textarea>
            <div class="modal-buttons">
                <button class="btn-primary" onclick="insertChart()">Create Chart</button>
                <button class="btn-secondary" onclick="closeModal('chartModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let chartCounter = 0;
        let currentSelectedImage = null;

        // Initialize editor
        document.addEventListener('DOMContentLoaded', function() {
            const fontFamily = document.getElementById('fontFamily');
            const fontSize = document.getElementById('fontSize');
            
            fontFamily.addEventListener('change', function() {
                formatText('fontName', this.value);
            });
            
            fontSize.addEventListener('change', function() {
                formatText('fontSize', this.value);
            });

            // Width slider update
            document.getElementById('imageWidth').addEventListener('input', function() {
                document.getElementById('widthValue').textContent = this.value + 'px';
            });
        });

        function formatText(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('document').focus();
        }

        function changeTextColor() {
            const color = document.getElementById('textColor').value;
            formatText('foreColor', color);
        }

        function changeBackgroundColor() {
            const color = document.getElementById('bgColor').value;
            formatText('backColor', color);
        }

        function insertQuickChart(type) {
            const sampleData = getSampleChartData(type);
            const chartId = 'chart_' + (++chartCounter);

            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            chartContainer.innerHTML = `
                <h3>Sample ${type.charAt(0).toUpperCase() + type.slice(1)} Chart</h3>
                <canvas id="${chartId}" width="400" height="200"></canvas>
            `;

            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.insertNode(chartContainer);
                range.collapse();
            } else {
                document.getElementById('document').appendChild(chartContainer);
            }

            // Create chart after DOM insertion
            setTimeout(() => {
                const ctx = document.getElementById(chartId).getContext('2d');
                new Chart(ctx, {
                    type: type,
                    data: sampleData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        }
                    }
                });
            }, 100);
        }

        function getSampleChartData(type) {
            const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'];
            
            if (type === 'pie' || type === 'doughnut') {
                return {
                    labels: ['Red', 'Blue', 'Yellow', 'Green'],
                    datasets: [{
                        data: [12, 19, 3, 5],
                        backgroundColor: colors.slice(0, 4)
                    }]
                };
            } else {
                return {
                    labels: ['January', 'February', 'March', 'April', 'May', 'June'],
                    datasets: [{
                        label: 'Sample Data',
                        data: [12, 19, 3, 17, 6, 10],
                        backgroundColor: type === 'line' ? 'rgba(54, 162, 235, 0.2)' : colors,
                        borderColor: type === 'line' ? 'rgba(54, 162, 235, 1)' : colors,
                        borderWidth: 1
                    }]
                };
            }
        }

        function showImageModal() {
            document.getElementById('imageModal').style.display = 'block';
        }

        function showTableModal() {
            document.getElementById('tableModal').style.display = 'block';
        }

        function showChartModal() {
            document.getElementById('chartModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function insertImage() {
            const file = document.getElementById('imageFile').files[0];
            const url = document.getElementById('imageUrl').value;
            const width = document.getElementById('imageWidth').value;

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    createImageElement(e.target.result, width);
                };
                reader.readAsDataURL(file);
            } else if (url) {
                createImageElement(url, width);
            }

            closeModal('imageModal');
        }

        function createImageElement(src, width) {
            const imageContainer = document.createElement('div');
            imageContainer.className = 'image-container';
            imageContainer.innerHTML = `
                <img src="${src}" style="width: ${width}px;" alt="Inserted image">
                <div class="image-controls">
                    <button onclick="editImage(this)">✏️</button>
                    <button onclick="deleteImage(this)">🗑️</button>
                </div>
            `;

            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.insertNode(imageContainer);
                range.collapse();
            } else {
                document.getElementById('document').appendChild(imageContainer);
            }
        }

        function editImage(button) {
            const img = button.closest('.image-container').querySelector('img');
            currentSelectedImage = img;
            
            const currentWidth = parseInt(img.style.width) || 300;
            document.getElementById('imageWidth').value = currentWidth;
            document.getElementById('widthValue').textContent = currentWidth + 'px';
            document.getElementById('imageUrl').value = img.src;
            
            showImageModal();
        }

        function deleteImage(button) {
            button.closest('.image-container').remove();
        }

        function insertTable() {
            const rows = parseInt(document.getElementById('tableRows').value);
            const cols = parseInt(document.getElementById('tableCols').value);
            const title = document.getElementById('tableTitle').value;

            let tableHTML = '';
            if (title) {
                tableHTML += `<h3>${title}</h3>`;
            }

            tableHTML += '<table><thead><tr>';
            for (let i = 0; i < cols; i++) {
                tableHTML += `<th>Header ${i + 1}</th>`;
            }
            tableHTML += '</tr></thead><tbody>';

            for (let i = 0; i < rows - 1; i++) {
                tableHTML += '<tr>';
                for (let j = 0; j < cols; j++) {
                    tableHTML += '<td contenteditable="true">Cell data</td>';
                }
                tableHTML += '</tr>';
            }

            tableHTML += '</tbody></table>';

            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.insertNode(createElementFromHTML(tableHTML));
                range.collapse();
            } else {
                document.getElementById('document').innerHTML += tableHTML;
            }

            closeModal('tableModal');
        }

        function insertChart() {
            const chartType = document.getElementById('chartType').value;
            const chartTitle = document.getElementById('chartTitle').value;
            const chartDataText = document.getElementById('chartData').value;

            try {
                const chartData = JSON.parse(chartDataText);
                const chartId = 'chart_' + (++chartCounter);

                const chartContainer = document.createElement('div');
                chartContainer.className = 'chart-container';
                chartContainer.innerHTML = `
                    ${chartTitle ? `<h3>${chartTitle}</h3>` : ''}
                    <canvas id="${chartId}" width="400" height="200"></canvas>
                `;

                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    range.insertNode(chartContainer);
                    range.collapse();
                } else {
                    document.getElementById('document').appendChild(chartContainer);
                }

                // Create chart after DOM insertion
                setTimeout(() => {
                    const ctx = document.getElementById(chartId).getContext('2d');
                    new Chart(ctx, {
                        type: chartType,
                        data: chartData,
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                }
                            }
                        }
                    });
                }, 100);

                closeModal('chartModal');
            } catch (error) {
                alert('Invalid JSON data. Please check your chart data format.');
            }
        }

        function createElementFromHTML(htmlString) {
            const div = document.createElement('div');
            div.innerHTML = htmlString.trim();
            return div.firstChild;
        }

        function showProgress() {
            document.getElementById('loadingIndicator').style.display = 'block';
            let progress = 0;
            const progressBar = document.getElementById('progressBar');
            
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('loadingIndicator').style.display = 'none';
                        progressBar.style.width = '0%';
                    }, 500);
                }
            }, 200);
        }

        async function exportToPDF() {
            showProgress();
            
            try {
                const { jsPDF } = window.jspdf;
                const element = document.getElementById('document');
                
                // Capture the entire document at high resolution
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    height: element.scrollHeight,
                    windowWidth: element.scrollWidth
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Calculate dimensions
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = pageWidth - 20; // 10mm margin on each side
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // If content fits on one page
                if (imgHeight <= pageHeight - 20) {
                    pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                } else {
                    // Multi-page PDF
                    const totalPages = Math.ceil(imgHeight / (pageHeight - 20));
                    const pageImgHeight = pageHeight - 20;
                    
                    for (let i = 0; i < totalPages; i++) {
                        if (i > 0) {
                            pdf.addPage();
                        }
                        
                        const sourceY = i * (canvas.height / totalPages);
                        const sourceHeight = canvas.height / totalPages;
                        
                        // Create a canvas for this page section
                        const pageCanvas = document.createElement('canvas');
                        const pageCtx = pageCanvas.getContext('2d');
                        pageCanvas.width = canvas.width;
                        pageCanvas.height = sourceHeight;
                        
                        pageCtx.drawImage(canvas, 0, sourceY, canvas.width, sourceHeight, 0, 0, canvas.width, sourceHeight);
                        const pageImgData = pageCanvas.toDataURL('image/png');
                        
                        pdf.addImage(pageImgData, 'PNG', 10, 10, imgWidth, pageImgHeight);
                    }
                }
                
                pdf.save('document.pdf');
            } catch (error) {
                alert('Error generating PDF: ' + error.message);
            }
        }

        function exportToWord() {
            showProgress();
            
            const content = document.getElementById('document').innerHTML;
            const blob = new Blob([`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title>Document</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
                        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; }
                        th { background-color: #f2f2f2; }
                        img { max-width: 100%; height: auto; }
                        .chart-container { margin: 20px 0; }
                    </style>
                </head>
                <body>${content}</body>
                </html>
            `], { type: 'application/msword' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'document.doc';
            link.click();
        }

        function saveDocument() {
            const content = document.getElementById('document').innerHTML;
            const blob = new Blob([`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <title>Document</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
                        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; }
                        th { background-color: #f2f2f2; }
                        img { max-width: 100%; height: auto; }
                        .chart-container { margin: 20px 0; }
                        .image-controls { display: none; }
                    </style>
                </head>
                <body>${content}</body>
                </html>
            `], { type: 'text/html' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'document.html';
            link.click();
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Auto-save functionality
        let autoSaveTimeout;
        document.getElementById('document').addEventListener('input', function() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                const content = this.innerHTML;
                // Store in memory (localStorage not available in Claude.ai)
                window.documentContent = content;
            }, 2000);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'b':
                        e.preventDefault();
                        formatText('bold');
                        break;
                    case 'i':
                        e.preventDefault();
                        formatText('italic');
                        break;
                    case 'u':
                        e.preventDefault();
                        formatText('underline');
                        break;
                    case 's':
                        e.preventDefault();
                        exportToPDF();
                        break;
                }
            }
        });
    </script>
</body>
</html>
